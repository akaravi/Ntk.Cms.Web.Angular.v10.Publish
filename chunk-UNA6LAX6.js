import{a as he}from"./chunk-ZKUYTZZF.js";import{a as Se}from"./chunk-MA5PBYEU.js";import{f as fe}from"./chunk-SAE3A2A6.js";import{I as re,Qb as me,Rb as ue,U as ae,aa as se,ab as de,da as ce,ea as pe,m as ie,p as oe,t as ne,z as le}from"./chunk-ITIAGMDL.js";import{Aq as R,Ca as E,Ed as X,F as L,Fa as r,Hb as U,I as N,Ic as Y,Id as C,Jb as W,Jc as J,Jd as Z,Ka as u,Mb as g,Nb as w,Ob as $,P as q,Pa as B,Pc as Q,Q as x,Sd as ee,Va as p,Vb as I,Wb as D,Xa as H,_d as te,bc as S,cb as j,cc as h,da as y,ea as _,ff as A,ib as l,jb as a,kb as s,lb as d,md as v,p as k,q as V,rd as M,sb as O,uc as K,vb as T,xb as f,yb as G,zb as z}from"./chunk-TLQAT62P.js";import{i as P}from"./chunk-SEDBTTTN.js";var ge=["*"];function Ie(n,e){if(n&1&&(a(0,"label",14),g(1),s()),n&2){let t=f();l("for",D("app-cms-site-selector-",t.id)),r(),w(t.optionLabel)}}function ve(n,e){if(n&1&&(d(0,"img",15),S(1,"cmsthumbnail")),n&2){let t=f();l("src",I(h(1,2,t.dataModelSelect==null?null:t.dataModelSelect.mainImageSrc)),E)}}function Me(n,e){if(n&1&&(d(0,"img",15),S(1,"cmsthumbnail")),n&2){let t=f().$implicit;l("src",I(h(1,2,t.mainImageSrc)),E)}}function be(n,e){if(n&1&&(a(0,"mat-option",16),p(1,Me,2,4,"img",5),a(2,"span"),g(3),s()()),n&2){let t=e.$implicit,i=f();l("value",t)("disabled",i.optionDisabled),r(),l("ngIf",t.mainImageSrc),r(2),w(i.displayOption(t))}}function ye(n,e){n&1&&d(0,"i",17)}function _e(n,e){n&1&&d(0,"i",18)}function Te(n,e){if(n&1){let t=O();a(0,"i",19),T("click",function(){y(t);let o=f();return _(o.onActionSelectClear())}),s()}}function Ae(n,e){n&1&&(a(0,"em"),g(1),S(2,"translate"),s()),n&2&&(r(),$("(",h(2,1,"TITLE.Necessary"),")"))}var c=class c{constructor(e,t,i,o,b){this.coreEnumService=e;this.cdr=t;this.publicHelper=i;this.translate=o;this.categoryService=b;this.id=++c.nextId;this.constructorInfoAreaId=this.constructor.name;this.dataModelResult=new X;this.dataModelSelect=new A;this.formControl=new ne;this.optionDisabled=!1;this.optionRequired=!1;this.optionSelectFirstItem=!1;this.optionPlaceholder="";this.optionLabel="";this.optionChange=new H;this.optionReload=()=>this.onActionButtonReload();this.lastSelectSiteId=[];this.publicHelper.processService.cdr=this.cdr,localStorage.getItem(R)&&(this.lastSelectSiteId=localStorage.getItem(R).split(",").map(function(m){return parseInt(m,10)}))}set optionSelectForce(e){this.onActionSelectForce(e)}ngOnInit(){this.loadOptions(),(!this.optionLabel||this.optionLabel.length==0&&this.optionPlaceholder?.length>0)&&(this.optionLabel=this.optionPlaceholder)}loadOptions(){this.filteredOptions=this.formControl.valueChanges.pipe(q(""),L(1500),N(),x(e=>typeof e=="string"||typeof e=="number"?this.DataGetAll(e):this.DataGetAll("")))}displayFn(e){return e?e.title:void 0}displayOption(e){return e?e.title:void 0}DataGetAll(e){return P(this,null,function*(){let t=new Z;if(t.rowPerPage=20,t.accessLoad=!0,e&&e.length>0){let o=new C;o=new C,o.propertyName="SubDomain",o.value=e,o.searchType=M.Contains,o.clauseType=v.Or,t.filters.push(o),o=new C,o.propertyName="Domain",o.value=e,o.searchType=M.Contains,o.clauseType=v.Or,t.filters.push(o),o=new C,o.propertyName="Title",o.value=e,o.searchType=M.Contains,o.clauseType=v.Or,t.filters.push(o),e&&typeof+e=="number"&&+e>0&&(o=new C,o.propertyName="Id",o.value=e,o.searchType=M.Equal,o.clauseType=v.Or,t.filters.push(o))}let i=this.constructor.name+"main";return this.translate.get("MESSAGE.List_of_authorized_sites").subscribe(o=>{this.publicHelper.processService.processStart(i,o,this.constructorInfoAreaId)}),yield k(this.categoryService.ServiceGetAll(t)).then(o=>(this.dataModelResult=o,this.lastSelectSiteId&&this.lastSelectSiteId.length>0&&this.lastSelectSiteId.forEach(b=>{let m=this.dataModelResult.listItems.findIndex(F=>F.id==b);m>0&&this.dataModelResult.listItems.splice(0,0,this.dataModelResult.listItems.splice(m,1)[0])}),this.optionSelectFirstItem&&(!this.dataModelSelect||!this.dataModelSelect.id||this.dataModelSelect.id<=0)&&this.dataModelResult.listItems.length>0&&(this.optionSelectFirstItem=!1,setTimeout(()=>{this.formControl.setValue(this.dataModelResult.listItems[0])},1e3),this.onActionSelect(this.dataModelResult.listItems[0])),this.publicHelper.processService.processStop(i),o.listItems))})}onActionSelect(e){if(this.optionDisabled)return;this.dataModelSelect=e,this.optionChange.emit(this.dataModelSelect),this.lastSelectSiteId||(this.lastSelectSiteId=[]);let t=this.lastSelectSiteId.findIndex(i=>i==e.id);t>=0&&this.lastSelectSiteId.splice(t,1),this.lastSelectSiteId.push(e.id),localStorage.setItem(R,this.lastSelectSiteId+"")}onActionSelectClear(){this.optionDisabled||(this.dataModelSelect=null,this.formControl.setValue(null),this.optionChange.emit(null))}push(e){return this.filteredOptions.pipe(V(t=>(t.find(i=>i.id===e.id)||t.push(e),t)))}onActionSelectForce(e){if(typeof e=="number"&&e>0){if(this.dataModelSelect&&this.dataModelSelect.id===e)return;if(this.dataModelResult&&this.dataModelResult.listItems&&this.dataModelResult.listItems.find(t=>t.id===e)){let t=this.dataModelResult.listItems.find(i=>i.id===e);this.dataModelSelect=t,this.formControl.setValue(t);return}this.categoryService.ServiceGetOneById(e).subscribe({next:t=>{t.isSuccess&&(this.filteredOptions=this.push(t.item),this.dataModelSelect=t.item,this.formControl.setValue(t.item),this.optionChange.emit(t.item))}});return}if(typeof e==typeof A){this.filteredOptions=this.push(e),this.dataModelSelect=e,this.formControl.setValue(e);return}this.formControl.setValue(null)}onActionButtonReload(){this.dataModelSelect=new A,this.loadOptions()}};c.nextId=0,c.\u0275fac=function(t){return new(t||c)(u(ee),u(K),u(fe),u(me),u(te))},c.\u0275cmp=B({type:c,selectors:[["app-cms-site-selector"]],inputs:{optionDisabled:"optionDisabled",optionRequired:"optionRequired",optionSelectFirstItem:"optionSelectFirstItem",optionPlaceholder:"optionPlaceholder",optionLabel:"optionLabel",optionReload:"optionReload",optionSelectForce:"optionSelectForce"},outputs:{optionChange:"optionChange"},standalone:!1,ngContentSelectors:ge,decls:18,vars:25,consts:[["matauto","matAutocomplete"],[1,"input-style","has-borders","has-icon","input-style-always-active","validate-field","mb-4","loader-container"],[3,"optionsInfoAreaId"],["class","color-highlight",3,"for",4,"ngIf"],["matPrefix",""],["style","vertical-align: middle","class","ntk-hover-zoom","aria-hidden","","height","25","width","25",3,"src",4,"ngIf"],["type","text","aria-label","Assignee","matInput","",3,"placeholder","formControl","matAutocomplete","required","id"],[3,"optionSelected","displayWith"],[3,"value","disabled",4,"ngFor","ngForOf"],["class","fa fa-info invalid color-red-dark",4,"ngIf"],["class","fa fa-check valid color-green-dark",4,"ngIf"],["class","fa fa-times action color-red-dark",3,"click",4,"ngIf"],[1,"fa","fa-rotate-right","action","color-green-dark",2,"margin-left","20px",3,"click","title"],[4,"ngIf"],[1,"color-highlight",3,"for"],["aria-hidden","","height","25","width","25",1,"ntk-hover-zoom",2,"vertical-align","middle",3,"src"],[3,"value","disabled"],[1,"fa","fa-info","invalid","color-red-dark"],[1,"fa","fa-check","valid","color-green-dark"],[1,"fa","fa-times","action","color-red-dark",3,"click"]],template:function(t,i){if(t&1){let o=O();G(),a(0,"div",1),d(1,"app-progress-spinner",2),p(2,Ie,2,3,"label",3),a(3,"span",4),p(4,ve,2,4,"img",5),g(5," \xA0"),s(),d(6,"input",6),a(7,"mat-autocomplete",7,0),T("optionSelected",function(m){return y(o),_(i.onActionSelect(m.option.value))}),p(9,be,4,4,"mat-option",8),S(10,"async"),s(),p(11,ye,1,0,"i",9)(12,_e,1,0,"i",10)(13,Te,1,0,"i",11),a(14,"i",12),S(15,"translate"),T("click",function(){return y(o),_(i.onActionButtonReload())}),s(),p(16,Ae,3,3,"em",13),z(17),s()}if(t&2){let o=U(8);r(),l("optionsInfoAreaId",i.constructorInfoAreaId),r(),l("ngIf",(i.optionLabel==null?null:i.optionLabel.length)>0),r(2),l("ngIf",i.dataModelSelect&&(i.dataModelSelect==null?null:i.dataModelSelect.mainImageSrc)),r(2),l("placeholder",I(i.optionPlaceholder))("id",D("app-cms-site-selector-",i.id))("formControl",i.formControl)("matAutocomplete",o)("required",i.optionRequired),j("disabled",i.optionDisabled?!0:null),r(),l("displayWith",i.displayFn),r(2),l("ngForOf",h(10,21,i.filteredOptions)),r(2),l("ngIf",!i.formControl.valid),r(),l("ngIf",i.optionRequired&&i.formControl.valid),r(),l("ngIf",(i.dataModelSelect==null?null:i.dataModelSelect.id)>0),r(),W("rotation360",i.publicHelper.processService.process.inRunArea[i.constructorInfoAreaId]),l("title",I(h(15,23,"ACTION.RELOAD"))),r(2),l("ngIf",i.optionRequired&&(!i.dataModelSelect||!i.dataModelSelect.id||i.dataModelSelect.id<=0))}},dependencies:[Y,J,ie,oe,re,le,ce,ae,pe,se,de,Se,Q,ue,he],encapsulation:2});var Ce=c;export{Ce as a};
