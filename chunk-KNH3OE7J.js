import{a as me}from"./chunk-ZA5O3IHT.js";import{a as pe}from"./chunk-76KFMOII.js";import{a as ce,d as de}from"./chunk-AFM3XPYU.js";import{f as se}from"./chunk-CZFZ5GBP.js";import{$b as oe,J as z,K as J,L as X,Na as $,Oa as ee,Pc as re,Sc as ae,Uc as le,X as Y,_ as Z,_b as ne,ab as te,cb as ie,n as j,q,r as L,t as W,v as K,w as Q}from"./chunk-ZS6LHH6I.js";import{Ab as d,Ca as O,Eb as D,Ed as H,Ee as P,Fa as o,Fb as V,Fd as k,Gb as R,Kb as T,Oa as c,Pb as s,Qb as x,Rb as _,Sa as U,Vb as A,Wb as w,We as B,Xb as y,Yb as b,_e as G,da as v,ea as g,fb as u,fc as m,gb as C,gc as f,lb as h,mb as a,nb as l,ob as S,qe as F,vb as I,xc as N,yb as E}from"./chunk-ZCQJE7HW.js";var ue=["vform"];function Ce(n,i){n&1&&(a(0,"p"),s(1),m(2,"translate"),l()),n&2&&(o(),_(" ",f(2,1,"AUTH.ENTER_EMAIL_FOR_CONFIRMATION")," "))}function he(n,i){n&1&&(a(0,"p"),s(1),m(2,"translate"),l()),n&2&&(o(),_(" ",f(2,1,"AUTH.CHECK_EMAIL_FOR_CONFIRMATION")," "))}function _e(n,i){n&1&&(a(0,"mat-error"),s(1," Email is "),a(2,"strong"),s(3),m(4,"translate"),l()()),n&2&&(o(3),x(f(4,1,"MESSAGE.required")))}function ve(n,i){if(n&1){let e=I();a(0,"div",10)(1,"label",11),s(2),l(),a(3,"input",12,1),y("ngModelChange",function(r){v(e);let p=d(2);return w(p.dataModel.email,r)||(p.dataModel.email=r),g(r)}),l(),a(5,"em"),s(6),l(),u(7,_e,5,3,"mat-error"),l()}if(n&2){let e=T(4),t=d(2);o(2),x(t.fieldsInfo.email==null?null:t.fieldsInfo.email.fieldTitle),o(),h("placeholder",b(t.fieldsInfo.email==null?null:t.fieldsInfo.email.fieldTitle)),A("ngModel",t.dataModel.email),h("disabled",!(t.fieldsInfo.email!=null&&t.fieldsInfo.email.accessAddField)),o(3),_("",e.value.length," / 100"),o(),C(e.errors!=null&&e.errors.required?7:-1)}}function ge(n,i){if(n&1&&u(0,ve,8,7,"div",10),n&2){let e=d();C(e.fieldsInfo.email!=null&&e.fieldsInfo.email.accessWatchField?0:-1)}}function Se(n,i){if(n&1){let e=I();a(0,"p"),s(1),m(2,"translate"),l(),a(3,"div",13)(4,"ng-otp-input",14,2),E("onInputChange",function(r){v(e);let p=d();return g(p.onOtpChange(r))}),l()()}if(n&2){let e=d();o(),_(" ",f(2,2,"AUTH.ENTER_RECEIVED_NUMBER")," "),o(3),h("config",e.otpConfig)}}function Ie(n,i){n&1&&(a(0,"mat-error"),s(1),m(2,"translate"),a(3,"strong"),s(4),m(5,"translate"),l()()),n&2&&(o(),_(" ",f(2,2,"AUTH.INPUT.CAPTCHACODE")," "),o(3),x(f(5,4,"MESSAGE.required")))}function Ee(n,i){if(n&1){let e=I();a(0,"img",15),E("click",function(){v(e);let r=d();return g(r.onCaptchaOrder())}),l(),a(1,"mat-icon",16),E("click",function(){v(e);let r=d();return g(r.onCaptchaOrder())}),s(2,"refresh"),l(),a(3,"div",17),S(4,"i",18),a(5,"input",19,3),m(7,"translate"),y("ngModelChange",function(r){v(e);let p=d();return w(p.dataModel.captchaText,r)||(p.dataModel.captchaText=r),g(r)}),l(),a(8,"label",20),s(9),m(10,"translate"),l(),S(11,"i",21)(12,"i",22),u(13,Ie,6,6,"mat-error"),l()}if(n&2){let e=T(6),t=d();h("src",b(t.captchaModel.image),O),o(5),h("placeholder",b(f(7,8,"AUTH.INPUT.CAPTCHACODE"))),A("ngModel",t.dataModel.captchaText),h("disabled",!t.formInfo.submitButtonEnabled),o(4),x(f(10,10,"AUTH.INPUT.CAPTCHACODE")),o(4),C(e.errors!=null&&e.errors.required?13:-1)}}function Me(n,i){if(n&1){let e=I();a(0,"div",9)(1,"button",23),E("click",function(){v(e);let r=d();return g(r.onFormCancel())}),S(2,"i",24),s(3),m(4,"translate"),l(),a(5,"button",25),S(6,"i",26),s(7),m(8,"translate"),l()()}if(n&2){let e=d(),t=T(8);o(3),_(" ",f(4,3,"ACTION.CANCEL")," "),o(2),h("disabled",!t.form.valid||e.stepTwo&&(e.dataModel==null||e.dataModel.code==null?null:e.dataModel.code.length)<4),o(2),_(" ",f(8,5,"ACTION.CONFIRM")," ")}}var M=class M{constructor(i,e,t,r,p,xe,Te,be,Ae,we,ye){this.data=i;this.dialogRef=e;this.coreEnumService=t;this.coreUserService=r;this.coreAuthService=p;this.cmsToastrService=xe;this.publicHelper=Te;this.tokenHelper=be;this.cmsStoreService=Ae;this.cdr=we;this.translate=ye;this.constructorInfoAreaId=this.constructor.name;this.firstRun=!0;this.countAutoCaptchaOrder=1;this.dataModelResult=new k;this.dataModel=new B;this.fieldsInfo=new Map;this.passwordIsValid=!1;this.captchaModel=new H;this.formInfo=new de;this.onCaptchaOrderInProcess=!1;this.otpConfig={allowNumbersOnly:!0,length:4,isPasswordInput:!1,disableAutoFocus:!1,placeholder:"",inputStyles:{width:"50px",height:"50px",margin:"5px"}};this.stepOne=!0;this.stepTwo=!1;this.publicHelper.processService.cdr=this.cdr}ngOnInit(){this.onCaptchaOrder(),this.translate.get("ACTION.CONFIRMEMAIL").subscribe(i=>{this.formInfo.formTitle=i}),this.tokenInfo=this.cmsStoreService.getStateAll.tokenInfoStore,this.tokenInfo&&(this.dataModel.email=this.tokenInfo.user.email,this.dataModel.linkUserId=this.tokenInfo.access.userId),this.DataGetAccess()}DataGetAccess(){let i=this.constructor.name+"DataGetAccess";this.translate.get("MESSAGE.Receiving_information").subscribe(e=>{this.publicHelper.processService.processStart(i,e,this.constructorInfoAreaId)}),this.coreUserService.ServiceViewModel().subscribe({next:e=>{e.isSuccess?this.fieldsInfo=this.publicHelper.fieldInfoConvertor(e.access):this.cmsToastrService.typeErrorGetAccess(e.errorMessage),this.publicHelper.processService.processStop(i)},error:e=>{this.cmsToastrService.typeErrorGetAccess(e),this.publicHelper.processService.processStop(i,!1)}})}onEmailConfirm(){this.dataModel.captchaKey=this.captchaModel.key,this.coreAuthService.ServiceEmailConfirm(this.dataModel).subscribe({next:i=>{i.isSuccess?(this.cmsToastrService.typeSuccessEmailConfirm(),this.stepOne?(this.stepOne=!1,this.stepTwo=!0,this.cmsToastrService.typeSuccessMessage("\u06A9\u062F \u0628\u0631\u0627\u06CC \u0627\u06CC\u0645\u06CC\u0644 \u0634\u0645\u0627 \u0627\u0631\u0633\u0627\u0644 \u0634\u062F")):this.stepTwo&&(this.stepOne=!1,this.stepTwo=!1,this.cmsToastrService.typeSuccessMessage("\u0627\u06CC\u0645\u06CC\u0644 \u0634\u0645\u0627 \u0628\u0627 \u0645\u0648\u0641\u0642\u06CC\u062A \u062A\u0627\u06CC\u06CC\u062F \u0634\u062F"),this.dialogRef.close({dialogChangedDate:!0}))):(this.cmsToastrService.typeErrorMessage(i.errorMessage),this.firstRun=!1,this.formInfo.submitButtonEnabled=!0,this.onCaptchaOrder())}})}onOtpChange(i){this.dataModel.code=i}onFormCancel(){this.dialogRef.close({dialogChangedDate:!1})}onCaptchaOrder(){if(this.onCaptchaOrderInProcess)return;this.countAutoCaptchaOrder=this.countAutoCaptchaOrder+1,this.dataModel.captchaText="";let i=this.constructor.name+".ServiceCaptcha";this.translate.get("MESSAGE.get_security_photo_content").subscribe(e=>{this.publicHelper.processService.processStart(i,e,this.constructorInfoAreaId)}),this.coreAuthService.ServiceCaptcha().subscribe({next:e=>{if(e.isSuccess){this.captchaModel=e.item,this.expireDate=e.item.expire;let t=new Date,p=new Date(e.item.expire).getTime()-t.getTime();this.countAutoCaptchaOrder<10&&(this.countAutoCaptchaOrder=this.countAutoCaptchaOrder+1,setTimeout(()=>{this.firstRun||this.onCaptchaOrder()},p))}else this.cmsToastrService.typeErrorGetCpatcha(e.errorMessage);this.onCaptchaOrderInProcess=!1,this.publicHelper.processService.processStop(i)},error:e=>{this.onCaptchaOrderInProcess=!1,this.publicHelper.processService.processStop(i)}})}};M.\u0275fac=function(e){return new(e||M)(c(ee),c($),c(F),c(P),c(G),c(le),c(se),c(ae),c(re),c(N),c(ne))},M.\u0275cmp=U({type:M,selectors:[["app-core-user-email-confirm"]],viewQuery:function(e,t){if(e&1&&D(ue,5),e&2){let r;V(r=R())&&(t.formGroup=r.first)}},standalone:!1,decls:13,vars:8,consts:[["vform","ngForm"],["Email",""],["ngOtpInput",""],["captchaText",""],[1,"card","card-style","loader-container"],[3,"optionsInfoAreaId"],[1,"content","mb-0"],[1,"mb-0","color-highlight","font-600","font-12"],[3,"ngSubmit"],[1,"form-actions"],[1,"input-style","has-borders","no-icon","input-style-always-active","validate-field","mb-4"],["for","dataModel.email",1,"color-highlight"],["matInput","","cmsKeyboardForce","en","name","dataModel.email","type","email","id","dataModel.email","required","",1,"form-control","validate-name","input-ltr-center",3,"ngModelChange","ngModel","disabled","placeholder"],[2,"text-align","center"],[3,"onInputChange","config"],["alt","",1,"mb-3",3,"click","src"],["matSuffix","",3,"click"],[1,"input-style","no-borders","has-icon","validate-field","mb-4"],[1,"fa","fa-quote-left"],["name","dataModel.captchaText","id","dataModel.captchaText","type","text","minlength","5","maxlength","5","autocomplete","off","required","",1,"form-control","validate-name","input-ltr-center",3,"ngModelChange","ngModel","disabled","placeholder"],["for","dataModel.captchaText",1,"color-highlight"],[1,"fa","fa-times","disabled","invalid","color-red-dark"],[1,"fa","fa-check","disabled","valid","color-green-dark"],["type","button",1,"btn","font-13","font-600","btn-s","m-1","rounded-s","shadow-xl","border-0","gradient-gray",3,"click"],[1,"ft-x"],["type","submit",1,"btn","font-13","font-600","btn-s","m-1","rounded-s","shadow-xl","border-0","gradient-highlight",3,"disabled"],[1,"fa","fa-check-square-o"]],template:function(e,t){if(e&1){let r=I();a(0,"div",4),S(1,"app-progress-spinner",5),a(2,"div",6)(3,"p",7),s(4),l(),u(5,Ce,3,3,"p"),u(6,he,3,3,"p"),a(7,"form",8,0),E("ngSubmit",function(){return v(r),g(t.onEmailConfirm())}),u(9,ge,1,1),u(10,Se,6,4),u(11,Ee,14,12),u(12,Me,9,7,"div",9),l()()()}e&2&&(o(),h("optionsInfoAreaId",t.constructorInfoAreaId),o(3),_(" ",t.formInfo.formTitle," "),o(),C(!t.dataModel.email||(t.dataModel==null||t.dataModel.email==null?null:t.dataModel.email.length)===0?5:-1),o(),C((t.dataModel==null||t.dataModel.email==null?null:t.dataModel.email.length)>0?6:-1),o(3),C(t.stepOne?9:-1),o(),C(t.stepTwo?10:-1),o(),C(t.firstRun?-1:11),o(),C(t.formInfo.submitButtonEnabled?12:-1))},dependencies:[Q,j,q,L,z,J,X,K,W,Y,Z,te,ie,ce,pe,me,oe],encapsulation:2});var fe=M;export{fe as a};
