import{Na as g,Oa as l,Ua as m,ua as f,wb as y}from"./chunk-R5MKRXT2.js";import{a as h}from"./chunk-SEDBTTTN.js";var K=new Set(["fa","ar","he","ps","ur"]),v={q:"\u0636",w:"\u0635",e:"\u062B",r:"\u0642",t:"\u0641",y:"\u063A",u:"\u0639",i:"\u0647",o:"\u062E",p:"\u062D","[":"\u062C","]":"\u0686",a:"\u0634",s:"\u0633",d:"\u06CC",f:"\u0628",g:"\u0644",h:"\u0627",j:"\u062A",k:"\u0646",l:"\u0645",";":"\u06A9","'":"\u06AF",z:"\u0638",x:"\u0637",c:"\u0632",v:"\u0631",b:"\u0630",n:"\u062F",m:"\u067E",",":"\u0648",".":"\u066B","/":"\u061F","`":"\u200D",1:"\u06F1",2:"\u06F2",3:"\u06F3",4:"\u06F4",5:"\u06F5",6:"\u06F6",7:"\u06F7",8:"\u06F8",9:"\u06F9",0:"\u06F0"},L=Object.entries(v).reduce((p,[e,t])=>(p[t]=e,p),{}),u={"en-fa":v,"fa-en":L},F={KeyQ:"q",KeyW:"w",KeyE:"e",KeyR:"r",KeyT:"t",KeyY:"y",KeyU:"u",KeyI:"i",KeyO:"o",KeyP:"p",KeyA:"a",KeyS:"s",KeyD:"d",KeyF:"f",KeyG:"g",KeyH:"h",KeyJ:"j",KeyK:"k",KeyL:"l",KeyZ:"z",KeyX:"x",KeyC:"c",KeyV:"v",KeyB:"b",KeyN:"n",KeyM:"m",Digit1:"1",Digit2:"2",Digit3:"3",Digit4:"4",Digit5:"5",Digit6:"6",Digit7:"7",Digit8:"8",Digit9:"9",Digit0:"0",Minus:"-",Equal:"=",BracketLeft:"[",BracketRight:"]",Backslash:"\\",Semicolon:";",Quote:"'",Backquote:"`",Comma:",",Period:".",Slash:"/",Space:" "},I={Digit1:"!",Digit2:"@",Digit3:"#",Digit4:"$",Digit5:"%",Digit6:"^",Digit7:"&",Digit8:"*",Digit9:"(",Digit0:")",Minus:"_",Equal:"+",BracketLeft:"{",BracketRight:"}",Backslash:"|",Semicolon:":",Quote:'"',Backquote:"~",Comma:"<",Period:">",Slash:"?"},a=class a{constructor(e,t){this.elementRef=e;this.renderer=t;this.targetLocale="fa";this.active=!1;this.suppressNextInput=!1;this.inputModeHintEnabled=!0;this.indicatorEnabled=!0;this.cloneMapEnabled=!0;this.normalizePasteEnabled=!0;this.smartReplaceEnabled=!0}set cmsKeyboardForce(e){this.targetLocale=this.normalizeLocale(e)??this.targetLocale,this.ensureDefaultSourceLocale()}set cmsKeyboardForceSource(e){this.sourceLocale=this.normalizeLocale(e)??this.sourceLocale}set cmsKeyboardForceMap(e){e&&Object.keys(e).length?this.customMap=this.cloneMapEnabled?h({},e):e:this.customMap=void 0}set cmsKeyboardForceInputMode(e){this.inputModeHintEnabled=this.coerceBoolean(e,!0)}set cmsKeyboardForceIndicator(e){this.indicatorEnabled=this.coerceBoolean(e,!0)}set cmsKeyboardForceCloneMap(e){this.cloneMapEnabled=this.coerceBoolean(e,!0)}set cmsKeyboardForceNormalizePaste(e){this.normalizePasteEnabled=this.coerceBoolean(e,!0)}set cmsKeyboardForceSmartReplace(e){this.smartReplaceEnabled=this.coerceBoolean(e,!0)}handleKeydown(e){if(!(e.key?.length===1)){this.lastKeyInfo=void 0;return}this.lastKeyInfo={shiftKey:e.shiftKey,capsLock:e.getModifierState("CapsLock"),code:e.code}}handleFocus(){this.active||(this.capturePreviousState(),this.applyLocale(),this.applyInputModeHint(),this.toggleIndicator(!0),this.active=!0)}handleBlur(){this.toggleIndicator(!1),this.restoreInputMode(),this.restoreState()}handleInput(e){if(this.suppressNextInput){this.suppressNextInput=!1,this.lastKeyInfo=void 0;return}if(!this.normalizePasteEnabled&&(e?.inputType==="insertFromPaste"||e?.inputType==="insertFromDrop")){this.lastKeyInfo=void 0;return}let t=this.getNativeTextInput();if(!t){this.lastKeyInfo=void 0;return}let r=t.value??"",i=t.selectionStart??r.length,n=e?.inputType==="insertText"&&i>0?{insertedIndex:i-1,lastKeyInfo:this.lastKeyInfo}:void 0,s=this.normalizeText(r,e?.data??void 0,n);if(this.lastKeyInfo=void 0,s===r)return;let o=t.selectionStart??s.length,d=t.selectionEnd??s.length;this.renderer.setProperty(t,"value",s),requestAnimationFrame(()=>{t.setSelectionRange(o,d)}),this.suppressNextInput=!0,t.dispatchEvent(new Event("input",{bubbles:!0}))}ngOnDestroy(){this.restoreState(!0)}applyLocale(){let e=this.resolveDirection(this.targetLocale),t=this.elementRef.nativeElement;this.renderer.setAttribute(t,"lang",this.targetLocale),this.renderer.setAttribute(t,"dir",e)}restoreState(e=!1){if(!this.active&&!e)return;let t=this.elementRef.nativeElement;this.previousElementLang!==void 0&&(this.previousElementLang===null||this.previousElementLang===""?this.renderer.removeAttribute(t,"lang"):this.renderer.setAttribute(t,"lang",this.previousElementLang)),this.previousElementDir!==void 0&&(this.previousElementDir===null||this.previousElementDir===""?this.renderer.removeAttribute(t,"dir"):this.renderer.setAttribute(t,"dir",this.previousElementDir)),this.previousElementLang=void 0,this.previousElementDir=void 0,this.active=!1}normalizeText(e,t,r){let i=this.resolveActiveMap(t??void 0);return i?this.smartReplaceEnabled&&r&&r.insertedIndex>=0&&r.insertedIndex<e.length?this.replaceSingleCharacter(e,r.insertedIndex,i,r):this.replaceCharacters(e,i,r):e}replaceCharacters(e,t,r){let i="";for(let n=0;n<e.length;n++){let s=e[n];if(this.isCharAlreadyTarget(s)){i+=s;continue}let o=t[s]??t[s.toLowerCase()];!o&&r&&r.insertedIndex===n&&(o=this.resolveFromCodeFallback(t,r?.lastKeyInfo)),o?i+=this.matchCase(s,o,n,r):i+=s}return i}resolveActiveMap(e){if(this.customMap)return this.customMap;if(this.sourceLocale){let t=`${this.sourceLocale}-${this.targetLocale}`,r=u[t];if(r)return r}if(e){let t=e.toLowerCase(),r=Object.values(u).find(i=>Object.prototype.hasOwnProperty.call(i,t));if(r)return r}}matchCase(e,t,r,i){return this.isCaseSensitive(e)?e===e.toUpperCase()?t.toUpperCase():t.toLowerCase():i&&i.insertedIndex===r&&i.lastKeyInfo?i.lastKeyInfo.shiftKey!==i.lastKeyInfo.capsLock?t.toUpperCase():t.toLowerCase():t}replaceSingleCharacter(e,t,r,i){let n=e[t];if(this.isCharAlreadyTarget(n))return e;let s=r[n]??r[n.toLowerCase()];if(s||(s=this.resolveFromCodeFallback(r,i?.lastKeyInfo)),!s)return e;let o=this.matchCase(n,s,t,i);return e.slice(0,t)+o+e.slice(t+1)}isCaseSensitive(e){return e.toLowerCase()!==e.toUpperCase()}getNativeTextInput(){let e=this.elementRef.nativeElement;return e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement?e:null}resolveDirection(e){if(this.cmsKeyboardForceDir)return this.cmsKeyboardForceDir;let t=this.normalizeLocale(e);return t&&K.has(t)?"rtl":"ltr"}normalizeLocale(e){let t=e?.trim().toLowerCase();return t||void 0}capturePreviousState(){let e=this.elementRef.nativeElement;this.previousElementLang=e.getAttribute("lang"),this.previousElementDir=e.getAttribute("dir"),this.previousInputMode=this.getNativeTextInput()?.getAttribute("inputmode")??void 0}ensureDefaultSourceLocale(){this.sourceLocale||(this.sourceLocale=this.targetLocale==="fa"?"en":"fa")}applyInputModeHint(){if(!this.inputModeHintEnabled)return;let e=this.getNativeTextInput();if(!e)return;let t=this.targetLocale==="en"?"latin":this.targetLocale==="fa"?"text":this.previousInputMode??e.getAttribute("inputmode")??void 0;t&&this.renderer.setAttribute(e,"inputmode",t)}restoreInputMode(){if(!this.inputModeHintEnabled)return;let e=this.getNativeTextInput();e&&this.previousInputMode!==void 0&&(this.previousInputMode===null||this.previousInputMode===""?this.renderer.removeAttribute(e,"inputmode"):this.renderer.setAttribute(e,"inputmode",this.previousInputMode),this.previousInputMode=void 0)}toggleIndicator(e){if(!this.indicatorEnabled)return;let t=this.elementRef.nativeElement;e?(this.renderer.addClass(t,"cms-keyboard-force--active"),this.renderer.setAttribute(t,"data-cms-keyboard-force",this.targetLocale)):(this.renderer.removeClass(t,"cms-keyboard-force--active"),this.renderer.removeAttribute(t,"data-cms-keyboard-force"))}coerceBoolean(e,t){return e==null||e===""?t:typeof e=="string"?e!=="false":e}resolveFromCodeFallback(e,t){if(!t?.code)return;let{code:r,shiftKey:i}=t,n=F[r];if(!n)return;let s=I[r],o=i&&s?s:n;if(this.targetLocale==="en")return o;let d=e[o]??e[o.toLowerCase()]??e[o.toUpperCase()];if(d)return d;if(o!==n)return o;let c=u[`en-${this.targetLocale}`];if(c)return c[n]??c[n.toLowerCase()]??c[n.toUpperCase()]}isCharAlreadyTarget(e){return e?this.targetLocale==="fa"?/[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF\u06F0-\u06F9]/.test(e):this.targetLocale==="en"?e.charCodeAt(0)<=127:!0:!0}};a.\u0275fac=function(t){return new(t||a)(l(f),l(g))},a.\u0275dir=m({type:a,selectors:[["","cmsKeyboardForce",""]],hostBindings:function(t,r){t&1&&y("keydown",function(n){return r.handleKeydown(n)})("focus",function(){return r.handleFocus()})("blur",function(){return r.handleBlur()})("input",function(n){return r.handleInput(n)})},inputs:{cmsKeyboardForce:"cmsKeyboardForce",cmsKeyboardForceDir:"cmsKeyboardForceDir",cmsKeyboardForceSource:"cmsKeyboardForceSource",cmsKeyboardForceMap:"cmsKeyboardForceMap",cmsKeyboardForceInputMode:"cmsKeyboardForceInputMode",cmsKeyboardForceIndicator:"cmsKeyboardForceIndicator",cmsKeyboardForceCloneMap:"cmsKeyboardForceCloneMap",cmsKeyboardForceNormalizePaste:"cmsKeyboardForceNormalizePaste",cmsKeyboardForceSmartReplace:"cmsKeyboardForceSmartReplace"},standalone:!1});var b=a;export{b as a};
