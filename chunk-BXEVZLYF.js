import{a as fe}from"./chunk-5K7YVPJ6.js";import{a as de}from"./chunk-NUBMZ3DS.js";import{Dc as me,Ha as X,Ia as Y,K as L,L as W,M as Q,Pa as Z,R as K,U as z,fc as le,gc as se,ma as J,o as F,r as P,s as G,u as B,uc as ce,vc as pe,w as j,x as q}from"./chunk-24G4XMFB.js";import{m as ae}from"./chunk-WNRZ34IP.js";import{$d as ie,Bb as V,Ca as U,Cb as N,Db as R,Fa as i,Hb as b,Jc as k,Ka as p,Mb as c,Md as $,Nb as M,Nd as ee,Ob as C,Pa as D,Qe as ne,Sb as A,Tb as w,Ub as O,Ud as te,Ue as oe,Va as _,Vb as y,bc as f,ca as h,cc as u,da as g,ib as s,jb as a,kb as l,lb as v,ne as re,pb as x,qb as T,sb as I,uc as H,vb as S,xb as m}from"./chunk-MDNBQXON.js";var Ce=["vform"];function he(n,r){n&1&&(a(0,"p"),c(1),f(2,"translate"),l()),n&2&&(i(),C(" ",u(2,1,"AUTH.ENTER_EMAIL_FOR_CONFIRMATION")," "))}function ge(n,r){n&1&&(a(0,"p"),c(1),f(2,"translate"),l()),n&2&&(i(),C(" ",u(2,1,"AUTH.CHECK_EMAIL_FOR_CONFIRMATION")," "))}function _e(n,r){n&1&&(a(0,"mat-error"),c(1," Email is "),a(2,"strong"),c(3),f(4,"translate"),l()()),n&2&&(i(3),M(u(4,1,"MESSAGE.required")))}function ve(n,r){if(n&1){let e=I();a(0,"div",12)(1,"label",13),c(2),l(),a(3,"input",14,1),O("ngModelChange",function(o){h(e);let d=m(2);return w(d.dataModel.email,o)||(d.dataModel.email=o),g(o)}),l(),a(5,"em"),c(6),l(),_(7,_e,5,3,"mat-error",8),l()}if(n&2){let e=b(4),t=m(2);i(2),M(t.fieldsInfo.email==null?null:t.fieldsInfo.email.fieldTitle),i(),s("placeholder",y(t.fieldsInfo.email==null?null:t.fieldsInfo.email.fieldTitle)),A("ngModel",t.dataModel.email),s("disabled",!(t.fieldsInfo.email!=null&&t.fieldsInfo.email.accessAddField)),i(3),C("",e.value.length," / 100"),i(),s("ngIf",e.errors==null?null:e.errors.required)}}function Ie(n,r){if(n&1&&(x(0),_(1,ve,8,7,"div",11),T()),n&2){let e=m();i(),s("ngIf",e.fieldsInfo.email==null?null:e.fieldsInfo.email.accessWatchField)}}function Se(n,r){if(n&1){let e=I();x(0),a(1,"p"),c(2),f(3,"translate"),l(),a(4,"div",15)(5,"ng-otp-input",16,2),S("onInputChange",function(o){h(e);let d=m();return g(d.onOtpChange(o))}),l()(),T()}if(n&2){let e=m();i(2),C(" ",u(3,2,"AUTH.ENTER_RECEIVED_NUMBER")," "),i(3),s("config",e.otpConfig)}}function Ee(n,r){n&1&&(a(0,"mat-error"),c(1),f(2,"translate"),a(3,"strong"),c(4),f(5,"translate"),l()()),n&2&&(i(),C(" ",u(2,2,"AUTH.INPUT.CAPTCHACODE")," "),i(3),M(u(5,4,"MESSAGE.required")))}function Me(n,r){if(n&1){let e=I();x(0),a(1,"img",17),S("click",function(){h(e);let o=m();return g(o.onCaptchaOrder())}),l(),a(2,"mat-icon",18),S("click",function(){h(e);let o=m();return g(o.onCaptchaOrder())}),c(3,"refresh"),l(),a(4,"div",19),v(5,"i",20),a(6,"input",21,3),f(8,"translate"),O("ngModelChange",function(o){h(e);let d=m();return w(d.dataModel.captchaText,o)||(d.dataModel.captchaText=o),g(o)}),l(),a(9,"label",22),c(10),f(11,"translate"),l(),v(12,"i",23)(13,"i",24),_(14,Ee,6,6,"mat-error",8),l(),T()}if(n&2){let e=b(7),t=m();i(),s("src",y(t.captchaModel.image),U),i(5),s("placeholder",y(u(8,8,"AUTH.INPUT.CAPTCHACODE"))),A("ngModel",t.dataModel.captchaText),s("disabled",!t.formInfo.buttonSubmittedEnabled),i(4),M(u(11,10,"AUTH.INPUT.CAPTCHACODE")),i(4),s("ngIf",e.errors==null?null:e.errors.required)}}function xe(n,r){if(n&1){let e=I();a(0,"div",25)(1,"button",26),S("click",function(){h(e);let o=m();return g(o.onFormCancel())}),v(2,"i",27),c(3),f(4,"translate"),l(),a(5,"button",28),v(6,"i",29),c(7),f(8,"translate"),l()()}if(n&2){let e=m(),t=b(8);i(3),C(" ",u(4,3,"ACTION.CANCEL")," "),i(2),s("disabled",!t.form.valid||e.stepTwo&&(e.dataModel==null||e.dataModel.code==null?null:e.dataModel.code.length)<4),i(2),C(" ",u(8,5,"ACTION.CONFIRM")," ")}}var E=class E{constructor(r,e,t,o,d,Te,be,ye,Ae,we,Oe){this.data=r;this.dialogRef=e;this.coreEnumService=t;this.coreUserService=o;this.coreAuthService=d;this.cmsToastrService=Te;this.publicHelper=be;this.tokenHelper=ye;this.cmsStoreService=Ae;this.cdr=we;this.translate=Oe;this.constructorInfoAreaId=this.constructor.name;this.firstRun=!0;this.countAutoCaptchaOrder=1;this.dataModelResult=new ee;this.dataModel=new ne;this.fieldsInfo=new Map;this.passwordIsValid=!1;this.captchaModel=new $;this.formInfo=new te;this.onCaptchaOrderInProcess=!1;this.otpConfig={allowNumbersOnly:!0,length:4,isPasswordInput:!1,disableAutoFocus:!1,placeholder:"",inputStyles:{width:"50px",height:"50px",margin:"5px"}};this.stepOne=!0;this.stepTwo=!1;this.publicHelper.processService.cdr=this.cdr}ngOnInit(){this.onCaptchaOrder(),this.translate.get("ACTION.CONFIRMEMAIL").subscribe(r=>{this.formInfo.formTitle=r}),this.tokenInfo=this.cmsStoreService.getStateAll.tokenInfoStore,this.tokenInfo&&(this.dataModel.email=this.tokenInfo.user.email,this.dataModel.linkUserId=this.tokenInfo.access.userId),this.DataGetAccess()}DataGetAccess(){let r=this.constructor.name+"DataGetAccess";this.translate.get("MESSAGE.Receiving_information").subscribe(e=>{this.publicHelper.processService.processStart(r,e,this.constructorInfoAreaId)}),this.coreUserService.ServiceViewModel().subscribe({next:e=>{e.isSuccess?this.fieldsInfo=this.publicHelper.fieldInfoConvertor(e.access):this.cmsToastrService.typeErrorGetAccess(e.errorMessage),this.publicHelper.processService.processStop(r)},error:e=>{this.cmsToastrService.typeErrorGetAccess(e),this.publicHelper.processService.processStop(r,!1)}})}onEmailConfirm(){this.dataModel.captchaKey=this.captchaModel.key,this.coreAuthService.ServiceEmailConfirm(this.dataModel).subscribe({next:r=>{r.isSuccess?(this.cmsToastrService.typeSuccessEmailConfirm(),this.stepOne?(this.stepOne=!1,this.stepTwo=!0,this.cmsToastrService.typeSuccessMessage("\u06A9\u062F \u0628\u0631\u0627\u06CC \u0627\u06CC\u0645\u06CC\u0644 \u0634\u0645\u0627 \u0627\u0631\u0633\u0627\u0644 \u0634\u062F")):this.stepTwo&&(this.stepOne=!1,this.stepTwo=!1,this.cmsToastrService.typeSuccessMessage("\u0627\u06CC\u0645\u06CC\u0644 \u0634\u0645\u0627 \u0628\u0627 \u0645\u0648\u0641\u0642\u06CC\u062A \u062A\u0627\u06CC\u06CC\u062F \u0634\u062F"),this.dialogRef.close({dialogChangedDate:!0}))):(this.cmsToastrService.typeErrorMessage(r.errorMessage),this.firstRun=!1,this.formInfo.buttonSubmittedEnabled=!0,this.onCaptchaOrder())}})}onOtpChange(r){this.dataModel.code=r}onFormCancel(){this.dialogRef.close({dialogChangedDate:!1})}onCaptchaOrder(){if(this.onCaptchaOrderInProcess)return;this.countAutoCaptchaOrder=this.countAutoCaptchaOrder+1,this.dataModel.captchaText="";let r=this.constructor.name+".ServiceCaptcha";this.translate.get("MESSAGE.get_security_photo_content").subscribe(e=>{this.publicHelper.processService.processStart(r,e,this.constructorInfoAreaId)}),this.coreAuthService.ServiceCaptcha().subscribe({next:e=>{if(e.isSuccess){this.captchaModel=e.item,this.expireDate=e.item.expire;let t=new Date,d=new Date(e.item.expire).getTime()-t.getTime();this.countAutoCaptchaOrder<10&&(this.countAutoCaptchaOrder=this.countAutoCaptchaOrder+1,setTimeout(()=>{this.firstRun||this.onCaptchaOrder()},d))}else this.cmsToastrService.typeErrorGetCpatcha(e.errorMessage);this.onCaptchaOrderInProcess=!1,this.publicHelper.processService.processStop(r)},error:e=>{this.onCaptchaOrderInProcess=!1,this.publicHelper.processService.processStop(r)}})}};E.\u0275fac=function(e){return new(e||E)(p(Y),p(X),p(ie),p(re),p(oe),p(pe),p(me),p(ce),p(ae),p(H),p(le))},E.\u0275cmp=D({type:E,selectors:[["app-core-user-email-confirm"]],viewQuery:function(e,t){if(e&1&&V(Ce,5),e&2){let o;N(o=R())&&(t.formGroup=o.first)}},standalone:!1,decls:13,vars:8,consts:[["vform","ngForm"],["Email",""],["ngOtpInput",""],["captchaText",""],[1,"card","card-style","loader-container"],[3,"optionsInfoAreaId"],[1,"content","mb-0"],[1,"mb-0","color-highlight","font-600","font-12"],[4,"ngIf"],[3,"ngSubmit"],["class","form-actions",4,"ngIf"],["class","input-style has-borders no-icon input-style-always-active validate-field mb-4",4,"ngIf"],[1,"input-style","has-borders","no-icon","input-style-always-active","validate-field","mb-4"],["for","dataModel.email",1,"color-highlight"],["matInput","","name","dataModel.email","type","email","id","dataModel.email","required","",1,"form-control","validate-name","input-ltr-center",3,"ngModelChange","ngModel","disabled","placeholder"],[2,"text-align","center"],[3,"onInputChange","config"],["alt","",1,"mb-3",3,"click","src"],["matSuffix","",3,"click"],[1,"input-style","no-borders","has-icon","validate-field","mb-4"],[1,"fa","fa-quote-left"],["name","dataModel.captchaText","id","dataModel.captchaText","type","text","minlength","5","maxlength","5","autocomplete","off","required","",1,"form-control","validate-name","input-ltr-center",3,"ngModelChange","ngModel","disabled","placeholder"],["for","dataModel.captchaText",1,"color-highlight"],[1,"fa","fa-times","disabled","invalid","color-red-dark"],[1,"fa","fa-check","disabled","valid","color-green-dark"],[1,"form-actions"],["type","button",1,"btn","font-13","font-600","btn-s","m-1","rounded-s","shadow-xl","border-0","gradient-gray",3,"click"],[1,"ft-x"],["type","submit",1,"btn","font-13","font-600","btn-s","m-1","rounded-s","shadow-xl","border-0","gradient-highlight",3,"disabled"],[1,"fa","fa-check-square-o"]],template:function(e,t){if(e&1){let o=I();a(0,"div",4),v(1,"app-progress-spinner",5),a(2,"div",6)(3,"p",7),c(4),l(),_(5,he,3,3,"p",8)(6,ge,3,3,"p",8),a(7,"form",9,0),S("ngSubmit",function(){return h(o),g(t.onEmailConfirm())}),_(9,Ie,2,1,"ng-container",8)(10,Se,7,4,"ng-container",8)(11,Me,15,12,"ng-container",8)(12,xe,9,7,"div",10),l()()()}e&2&&(i(),s("optionsInfoAreaId",t.constructorInfoAreaId),i(3),C(" ",t.formInfo.formTitle," "),i(),s("ngIf",!t.dataModel.email||(t.dataModel==null||t.dataModel.email==null?null:t.dataModel.email.length)===0),i(),s("ngIf",(t.dataModel==null||t.dataModel.email==null?null:t.dataModel.email.length)>0),i(3),s("ngIf",t.stepOne),i(),s("ngIf",t.stepTwo),i(),s("ngIf",!t.firstRun),i(),s("ngIf",t.formInfo.formSubmitAllow))},dependencies:[k,q,F,P,G,L,W,Q,j,B,K,z,Z,J,de,fe,se],encapsulation:2});var ue=E;export{ue as a};
